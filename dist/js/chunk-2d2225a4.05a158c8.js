(window["webpackJsonp"]=window["webpackJsonp"]||[]).push([["chunk-2d2225a4"],{cdf3:function(s,a,t){"use strict";t.r(a);var e=function(){var s=this,a=s.$createElement,t=s._self._c||a;return t("div",[t("md")],1)},r=[],n=function(){var s=this,a=s.$createElement;s._self._c;return s._m(0)},l=[function(){var s=this,a=s.$createElement,t=s._self._c||a;return t("section",[t("h3",[s._v("实现目标")]),t("ul",[t("li",[t("p",[s._v("插值绑定")]),t("ul",[t("li",[s._v("在 "),t("code",{pre:!0},[s._v("html")]),s._v(" 中 绑定 "),t("code",{pre:!0},[s._v("counter")])]),t("li",[s._v("初始化显示 "),t("code",{pre:!0},[s._v("1")])]),t("li",[s._v("间隔 1s，"),t("code",{pre:!0},[s._v("counter")]),s._v(" 加 1")])])]),t("li",[t("p",[t("code",{pre:!0},[s._v("v-html")]),s._v("：显示一段 "),t("code",{pre:!0},[s._v("html")])])]),t("li",[t("p",[t("code",{pre:!0},[s._v("v-model")]),s._v("：实现双向绑定")])]),t("li",[t("p",[t("code",{pre:!0},[s._v("@click")]),s._v("：实现点击事件")])])]),t("p",[s._v("效果如下：")]),t("img",{attrs:{src:"https://relearnvue.com/static/mvvm.gif"}}),t("pre",{pre:!0},[t("code",{pre:!0,attrs:{"v-pre":"",class:"language-HTML"}},[t("span",{pre:!0,attrs:{class:"hljs-tag"}},[s._v("<"),t("span",{pre:!0,attrs:{class:"hljs-name"}},[s._v("body")]),s._v(">")]),s._v("\n  "),t("span",{pre:!0,attrs:{class:"hljs-tag"}},[s._v("<"),t("span",{pre:!0,attrs:{class:"hljs-name"}},[s._v("div")]),s._v(" "),t("span",{pre:!0,attrs:{class:"hljs-attr"}},[s._v("id")]),s._v("="),t("span",{pre:!0,attrs:{class:"hljs-string"}},[s._v('"app"')]),s._v(">")]),s._v("\n    "),t("span",{pre:!0,attrs:{class:"hljs-tag"}},[s._v("<"),t("span",{pre:!0,attrs:{class:"hljs-name"}},[s._v("p")]),s._v(">")]),s._v("{{counter}}"),t("span",{pre:!0,attrs:{class:"hljs-tag"}},[s._v("</"),t("span",{pre:!0,attrs:{class:"hljs-name"}},[s._v("p")]),s._v(">")]),s._v("\n    "),t("span",{pre:!0,attrs:{class:"hljs-tag"}},[s._v("<"),t("span",{pre:!0,attrs:{class:"hljs-name"}},[s._v("p")]),s._v(" "),t("span",{pre:!0,attrs:{class:"hljs-attr"}},[s._v("@click")]),s._v("="),t("span",{pre:!0,attrs:{class:"hljs-string"}},[s._v('"clickHandle"')]),s._v(">")]),s._v("{{count}}"),t("span",{pre:!0,attrs:{class:"hljs-tag"}},[s._v("</"),t("span",{pre:!0,attrs:{class:"hljs-name"}},[s._v("p")]),s._v(">")]),s._v("\n    "),t("span",{pre:!0,attrs:{class:"hljs-tag"}},[s._v("<"),t("span",{pre:!0,attrs:{class:"hljs-name"}},[s._v("p")]),s._v(" "),t("span",{pre:!0,attrs:{class:"hljs-attr"}},[s._v("v-html")]),s._v("="),t("span",{pre:!0,attrs:{class:"hljs-string"}},[s._v('"htmlContent"')]),s._v(">")]),t("span",{pre:!0,attrs:{class:"hljs-tag"}},[s._v("</"),t("span",{pre:!0,attrs:{class:"hljs-name"}},[s._v("p")]),s._v(">")]),s._v("\n    "),t("span",{pre:!0,attrs:{class:"hljs-tag"}},[s._v("<"),t("span",{pre:!0,attrs:{class:"hljs-name"}},[s._v("input")]),s._v(" "),t("span",{pre:!0,attrs:{class:"hljs-attr"}},[s._v("type")]),s._v("="),t("span",{pre:!0,attrs:{class:"hljs-string"}},[s._v('"text"')]),s._v(" "),t("span",{pre:!0,attrs:{class:"hljs-attr"}},[s._v("v-model")]),s._v("="),t("span",{pre:!0,attrs:{class:"hljs-string"}},[s._v('"username"')]),s._v(" />")]),s._v("\n    "),t("span",{pre:!0,attrs:{class:"hljs-tag"}},[s._v("<"),t("span",{pre:!0,attrs:{class:"hljs-name"}},[s._v("p")]),s._v(">")]),s._v("{{username}}"),t("span",{pre:!0,attrs:{class:"hljs-tag"}},[s._v("</"),t("span",{pre:!0,attrs:{class:"hljs-name"}},[s._v("p")]),s._v(">")]),s._v("\n  "),t("span",{pre:!0,attrs:{class:"hljs-tag"}},[s._v("</"),t("span",{pre:!0,attrs:{class:"hljs-name"}},[s._v("div")]),s._v(">")]),s._v("\n  "),t("span",{pre:!0,attrs:{class:"hljs-tag"}},[s._v("<"),t("span",{pre:!0,attrs:{class:"hljs-name"}},[s._v("script")]),s._v(" "),t("span",{pre:!0,attrs:{class:"hljs-attr"}},[s._v("src")]),s._v("="),t("span",{pre:!0,attrs:{class:"hljs-string"}},[s._v('"./mvvm.js"')]),s._v(">")]),t("span",{pre:!0,attrs:{class:"hljs-tag"}},[s._v("</"),t("span",{pre:!0,attrs:{class:"hljs-name"}},[s._v("script")]),s._v(">")]),s._v("\n  "),t("span",{pre:!0,attrs:{class:"hljs-tag"}},[s._v("<"),t("span",{pre:!0,attrs:{class:"hljs-name"}},[s._v("script")]),s._v(">")]),t("span",{pre:!0,attrs:{class:"javascript"}},[s._v("\n    "),t("span",{pre:!0,attrs:{class:"hljs-keyword"}},[s._v("const")]),s._v(" app = "),t("span",{pre:!0,attrs:{class:"hljs-keyword"}},[s._v("new")]),s._v(" Mvvm({\n      "),t("span",{pre:!0,attrs:{class:"hljs-attr"}},[s._v("el")]),s._v(": "),t("span",{pre:!0,attrs:{class:"hljs-string"}},[s._v("'#app'")]),s._v(",\n      "),t("span",{pre:!0,attrs:{class:"hljs-attr"}},[s._v("data")]),s._v(": {\n        "),t("span",{pre:!0,attrs:{class:"hljs-attr"}},[s._v("counter")]),s._v(": "),t("span",{pre:!0,attrs:{class:"hljs-number"}},[s._v("1")]),s._v(",\n        "),t("span",{pre:!0,attrs:{class:"hljs-attr"}},[s._v("count")]),s._v(": "),t("span",{pre:!0,attrs:{class:"hljs-number"}},[s._v("0")]),s._v(",\n        "),t("span",{pre:!0,attrs:{class:"hljs-attr"}},[s._v("username")]),s._v(": "),t("span",{pre:!0,attrs:{class:"hljs-string"}},[s._v("'我叫小红'")]),s._v(",\n        "),t("span",{pre:!0,attrs:{class:"hljs-attr"}},[s._v("htmlContent")]),s._v(": "),t("span",{pre:!0,attrs:{class:"hljs-string"}},[s._v("\"<span style='color: red;'>嘻嘻</span>\"")]),s._v("\n      },\n      "),t("span",{pre:!0,attrs:{class:"hljs-attr"}},[s._v("methods")]),s._v(": {\n        clickHandle() {\n          "),t("span",{pre:!0,attrs:{class:"hljs-keyword"}},[s._v("this")]),s._v(".count++\n        }\n      }\n    })\n    "),t("span",{pre:!0,attrs:{class:"hljs-comment"}},[s._v("// 改变counter")]),s._v("\n    setInterval("),t("span",{pre:!0,attrs:{class:"hljs-function"}},[t("span",{pre:!0,attrs:{class:"hljs-params"}},[s._v("()")]),s._v(" =>")]),s._v(" {\n      app.counter++\n    }, "),t("span",{pre:!0,attrs:{class:"hljs-number"}},[s._v("1000")]),s._v(")\n  ")]),t("span",{pre:!0,attrs:{class:"hljs-tag"}},[s._v("</"),t("span",{pre:!0,attrs:{class:"hljs-name"}},[s._v("script")]),s._v(">")]),s._v("\n"),t("span",{pre:!0,attrs:{class:"hljs-tag"}},[s._v("</"),t("span",{pre:!0,attrs:{class:"hljs-name"}},[s._v("body")]),s._v(">")]),s._v("\n")])]),t("p",[s._v("看起来很简单啊 😆 ， 自己实现一下试试")]),t("h3",[s._v("mvvm 要做的事")]),t("ol",[t("li",[s._v("对 "),t("code",{pre:!0},[s._v("data")]),s._v(" 数据进行响应式处理")]),t("li",[t("code",{pre:!0},[s._v("{{}}")]),s._v("、"),t("code",{pre:!0},[s._v("v-model")]),s._v("、"),t("code",{pre:!0},[s._v("v-html")]),s._v("、"),t("code",{pre:!0},[s._v("@click")]),s._v("并不是原生的 "),t("code",{pre:!0},[s._v("html")]),s._v(" 标记，需要进行解析，并从 "),t("code",{pre:!0},[s._v("data")]),s._v(" 中取出对应的值，初始化页面")]),t("li",[s._v("对 "),t("code",{pre:!0},[s._v("html")]),s._v(" 中用到的数据进行收集，当该值变化时，通知所有用到的地方进行更新")])]),t("p",[s._v("为了解决上面几个问题，创建一些类来负责对应的工作：")]),t("ul",[t("li",[s._v("Observe：负责数据响应式处理")]),t("li",[s._v("Compile：解析模板，给每一个 key 创建一个 watcher")]),t("li",[s._v("Watcher：负责执行更新函数（每一个模板中用到的数据都会对应一个 Watcher）")]),t("li",[s._v("Dep：收集 Watcher（同一个 key 可能在模板中多次使用，当数据更新时，通知 Dep，Dep 通知它收集到的所有 Watcher 执行更新）")])]),t("h3",[s._v("原理图：")]),t("img",{staticStyle:{width:"800px"},attrs:{src:"https://relearnvue.com/static/mvvm.png"}}),t("h3",[s._v("Dep")]),t("p",[s._v("Dep 只做两件事情")]),t("ul",[t("li",[s._v("收集 watcher（在哪里收集？）")]),t("li",[s._v("通知更新（在哪里通知更新？）")])]),t("pre",{pre:!0},[t("code",{pre:!0,attrs:{"v-pre":"",class:"language-js"}},[t("span",{pre:!0,attrs:{class:"hljs-class"}},[t("span",{pre:!0,attrs:{class:"hljs-keyword"}},[s._v("class")]),s._v(" "),t("span",{pre:!0,attrs:{class:"hljs-title"}},[s._v("Dep")]),s._v(" ")]),s._v("{\n  "),t("span",{pre:!0,attrs:{class:"hljs-keyword"}},[s._v("constructor")]),s._v("() {\n    "),t("span",{pre:!0,attrs:{class:"hljs-keyword"}},[s._v("this")]),s._v(".deps = []\n  }\n  "),t("span",{pre:!0,attrs:{class:"hljs-comment"}},[s._v("// 添加watcher")]),s._v("\n  addDep(watcher) {\n    "),t("span",{pre:!0,attrs:{class:"hljs-keyword"}},[s._v("this")]),s._v(".deps.push(watcher)\n  }\n  "),t("span",{pre:!0,attrs:{class:"hljs-comment"}},[s._v("// 通知更新，遍历每一个watcher，然后watcher调用自己的update方法")]),s._v("\n  notify() {\n    "),t("span",{pre:!0,attrs:{class:"hljs-keyword"}},[s._v("this")]),s._v(".deps.forEach("),t("span",{pre:!0,attrs:{class:"hljs-function"}},[t("span",{pre:!0,attrs:{class:"hljs-params"}},[s._v("watcher")]),s._v(" =>")]),s._v(" watcher.update())\n  }\n}\n")])]),t("h3",[s._v("Watcher")]),t("p",[s._v("编译解析模板时，每遇到一个 "),t("code",{pre:!0},[s._v("key")]),s._v("，就为它创建一个 "),t("code",{pre:!0},[s._v("watcher")]),s._v(" 对象，在初始化时，会读取一次，是为了触发 "),t("code",{pre:!0},[s._v("getter")]),s._v(" 方法，将该 "),t("code",{pre:!0},[s._v("watcher")]),s._v(" 添加到 "),t("code",{pre:!0},[s._v("Dep")]),s._v(" 中")]),t("pre",{pre:!0},[t("code",{pre:!0,attrs:{"v-pre":"",class:"language-js"}},[t("span",{pre:!0,attrs:{class:"hljs-class"}},[t("span",{pre:!0,attrs:{class:"hljs-keyword"}},[s._v("class")]),s._v(" "),t("span",{pre:!0,attrs:{class:"hljs-title"}},[s._v("Watcher")]),s._v(" ")]),s._v("{\n  "),t("span",{pre:!0,attrs:{class:"hljs-comment"}},[s._v("// updateFn就是更新方法")]),s._v("\n  "),t("span",{pre:!0,attrs:{class:"hljs-keyword"}},[s._v("constructor")]),s._v("(vm, key, updateFn) {\n    "),t("span",{pre:!0,attrs:{class:"hljs-keyword"}},[s._v("this")]),s._v(".vm = vm\n    "),t("span",{pre:!0,attrs:{class:"hljs-keyword"}},[s._v("this")]),s._v(".key = key\n    "),t("span",{pre:!0,attrs:{class:"hljs-keyword"}},[s._v("this")]),s._v(".updateFn = updateFn\n\n    "),t("span",{pre:!0,attrs:{class:"hljs-comment"}},[s._v("// 将当前watcher设置给Dep.target")]),s._v("\n    Dep.target = "),t("span",{pre:!0,attrs:{class:"hljs-keyword"}},[s._v("this")]),s._v("\n    "),t("span",{pre:!0,attrs:{class:"hljs-comment"}},[s._v("// 读取一次key，触发getter，收集该watcher")]),s._v("\n    "),t("span",{pre:!0,attrs:{class:"hljs-keyword"}},[s._v("this")]),s._v(".vm["),t("span",{pre:!0,attrs:{class:"hljs-keyword"}},[s._v("this")]),s._v(".key]\n    "),t("span",{pre:!0,attrs:{class:"hljs-comment"}},[s._v("// 清除")]),s._v("\n    Dep.target = "),t("span",{pre:!0,attrs:{class:"hljs-literal"}},[s._v("null")]),s._v("\n  }\n  "),t("span",{pre:!0,attrs:{class:"hljs-comment"}},[s._v("// 更新方法")]),s._v("\n  update() {\n    "),t("span",{pre:!0,attrs:{class:"hljs-keyword"}},[s._v("this")]),s._v(".updateFn.call("),t("span",{pre:!0,attrs:{class:"hljs-keyword"}},[s._v("this")]),s._v(".vm, "),t("span",{pre:!0,attrs:{class:"hljs-keyword"}},[s._v("this")]),s._v(".vm["),t("span",{pre:!0,attrs:{class:"hljs-keyword"}},[s._v("this")]),s._v(".key])\n  }\n}\n")])]),t("h3",[s._v("Observe")]),t("p",[s._v("数据响应式")]),t("pre",{pre:!0},[t("code",{pre:!0,attrs:{"v-pre":"",class:"language-js"}},[t("span",{pre:!0,attrs:{class:"hljs-class"}},[t("span",{pre:!0,attrs:{class:"hljs-keyword"}},[s._v("class")]),s._v(" "),t("span",{pre:!0,attrs:{class:"hljs-title"}},[s._v("Observe")]),s._v(" ")]),s._v("{\n  "),t("span",{pre:!0,attrs:{class:"hljs-keyword"}},[s._v("constructor")]),s._v("(value) {\n    "),t("span",{pre:!0,attrs:{class:"hljs-keyword"}},[s._v("this")]),s._v(".value = value\n    "),t("span",{pre:!0,attrs:{class:"hljs-comment"}},[s._v("// 源码中会区分对象和数组，这里忽略...")]),s._v("\n    "),t("span",{pre:!0,attrs:{class:"hljs-keyword"}},[s._v("this")]),s._v(".walk(value)\n  }\n\n  walk(obj) {\n    "),t("span",{pre:!0,attrs:{class:"hljs-comment"}},[s._v("// 对每一个key进行响应书处理")]),s._v("\n    "),t("span",{pre:!0,attrs:{class:"hljs-built_in"}},[s._v("Object")]),s._v(".keys(obj).forEach("),t("span",{pre:!0,attrs:{class:"hljs-function"}},[t("span",{pre:!0,attrs:{class:"hljs-params"}},[s._v("key")]),s._v(" =>")]),s._v(" {\n      defineReactive(obj, key, obj[key])\n    })\n  }\n\n  defineReactive(obj, key, val) {\n    "),t("span",{pre:!0,attrs:{class:"hljs-comment"}},[s._v("// 这里需要对val递归处理，略去...")]),s._v("\n    "),t("span",{pre:!0,attrs:{class:"hljs-comment"}},[s._v("// 每一个key对应一个dep")]),s._v("\n    "),t("span",{pre:!0,attrs:{class:"hljs-keyword"}},[s._v("const")]),s._v(" dep = "),t("span",{pre:!0,attrs:{class:"hljs-keyword"}},[s._v("new")]),s._v(" Dep()\n    "),t("span",{pre:!0,attrs:{class:"hljs-built_in"}},[s._v("Object")]),s._v(".defineProperty(obj, key, {\n      "),t("span",{pre:!0,attrs:{class:"hljs-keyword"}},[s._v("get")]),s._v("() {\n        "),t("span",{pre:!0,attrs:{class:"hljs-built_in"}},[s._v("console")]),s._v(".log("),t("span",{pre:!0,attrs:{class:"hljs-string"}},[s._v("'读取：'")]),s._v(", key)\n        "),t("span",{pre:!0,attrs:{class:"hljs-comment"}},[s._v("// 当创建watcher时，Dep.target会指向当前watcher，添加到dep中")]),s._v("\n        Dep.target && dep.addDep(Dep.target)\n        "),t("span",{pre:!0,attrs:{class:"hljs-keyword"}},[s._v("return")]),s._v(" val\n      },\n      "),t("span",{pre:!0,attrs:{class:"hljs-keyword"}},[s._v("set")]),s._v("(newVal) {\n        "),t("span",{pre:!0,attrs:{class:"hljs-keyword"}},[s._v("if")]),s._v(" (newVal !== val) {\n          "),t("span",{pre:!0,attrs:{class:"hljs-built_in"}},[s._v("console")]),s._v(".log("),t("span",{pre:!0,attrs:{class:"hljs-string"}},[s._v("'设置：'")]),s._v(", key)\n          observe(newVal)\n          val = newVal\n          "),t("span",{pre:!0,attrs:{class:"hljs-comment"}},[s._v("// 通知更新")]),s._v("\n          dep.notify()\n        }\n      }\n    })\n  }\n}\n")])]),t("h3",[s._v("Compile")]),t("p",[s._v("模板编译：遍历模板，解析出 "),t("code",{pre:!0},[s._v("vue")]),s._v(" 特有的指令、语法糖等，分别处理")]),t("pre",{pre:!0},[t("code",{pre:!0,attrs:{"v-pre":"",class:"language-js"}},[t("span",{pre:!0,attrs:{class:"hljs-class"}},[t("span",{pre:!0,attrs:{class:"hljs-keyword"}},[s._v("class")]),s._v(" "),t("span",{pre:!0,attrs:{class:"hljs-title"}},[s._v("Compile")]),s._v(" ")]),s._v("{\n  "),t("span",{pre:!0,attrs:{class:"hljs-keyword"}},[s._v("constructor")]),s._v("(el, vm) {\n    "),t("span",{pre:!0,attrs:{class:"hljs-keyword"}},[s._v("this")]),s._v(".$vm = vm\n    "),t("span",{pre:!0,attrs:{class:"hljs-keyword"}},[s._v("this")]),s._v(".$el = "),t("span",{pre:!0,attrs:{class:"hljs-built_in"}},[s._v("document")]),s._v(".querySelector(el)\n\n    "),t("span",{pre:!0,attrs:{class:"hljs-keyword"}},[s._v("if")]),s._v(" ("),t("span",{pre:!0,attrs:{class:"hljs-keyword"}},[s._v("this")]),s._v(".$el) {\n      "),t("span",{pre:!0,attrs:{class:"hljs-keyword"}},[s._v("this")]),s._v(".compile("),t("span",{pre:!0,attrs:{class:"hljs-keyword"}},[s._v("this")]),s._v(".$el)\n    }\n  }\n\n  compile(el) {\n    "),t("span",{pre:!0,attrs:{class:"hljs-comment"}},[s._v("// 遍历节点，分类处理")]),s._v("\n    "),t("span",{pre:!0,attrs:{class:"hljs-keyword"}},[s._v("const")]),s._v(" childNodes = el.childNodes\n    "),t("span",{pre:!0,attrs:{class:"hljs-built_in"}},[s._v("Array")]),s._v(".from(childNodes).forEach("),t("span",{pre:!0,attrs:{class:"hljs-function"}},[t("span",{pre:!0,attrs:{class:"hljs-params"}},[s._v("node")]),s._v(" =>")]),s._v(" {\n      "),t("span",{pre:!0,attrs:{class:"hljs-keyword"}},[s._v("if")]),s._v(" ("),t("span",{pre:!0,attrs:{class:"hljs-keyword"}},[s._v("this")]),s._v(".isElement(node)) {\n        "),t("span",{pre:!0,attrs:{class:"hljs-comment"}},[s._v("// 编译元素")]),s._v("\n        "),t("span",{pre:!0,attrs:{class:"hljs-keyword"}},[s._v("this")]),s._v(".compileElement(node)\n      } "),t("span",{pre:!0,attrs:{class:"hljs-keyword"}},[s._v("else")]),s._v(" "),t("span",{pre:!0,attrs:{class:"hljs-keyword"}},[s._v("if")]),s._v(" ("),t("span",{pre:!0,attrs:{class:"hljs-keyword"}},[s._v("this")]),s._v(".isInterpolation(node)) {\n        "),t("span",{pre:!0,attrs:{class:"hljs-comment"}},[s._v("// 编译插值文本")]),s._v("\n        "),t("span",{pre:!0,attrs:{class:"hljs-keyword"}},[s._v("this")]),s._v(".text(node)\n      }\n      "),t("span",{pre:!0,attrs:{class:"hljs-comment"}},[s._v("// 递归处理子节点")]),s._v("\n      "),t("span",{pre:!0,attrs:{class:"hljs-keyword"}},[s._v("if")]),s._v(" (node.childNodes && node.childNodes.length > "),t("span",{pre:!0,attrs:{class:"hljs-number"}},[s._v("0")]),s._v(") {\n        "),t("span",{pre:!0,attrs:{class:"hljs-keyword"}},[s._v("this")]),s._v(".compile(node)\n      }\n    })\n  }\n\n  "),t("span",{pre:!0,attrs:{class:"hljs-comment"}},[s._v("// 编译元素节点")]),s._v("\n  compileElement(node) {\n    "),t("span",{pre:!0,attrs:{class:"hljs-keyword"}},[s._v("const")]),s._v(" attrs = node.attributes\n    "),t("span",{pre:!0,attrs:{class:"hljs-comment"}},[s._v("// 遍历属性，解析指令")]),s._v("\n    "),t("span",{pre:!0,attrs:{class:"hljs-built_in"}},[s._v("Array")]),s._v(".from(attrs).forEach("),t("span",{pre:!0,attrs:{class:"hljs-function"}},[t("span",{pre:!0,attrs:{class:"hljs-params"}},[s._v("attr")]),s._v(" =>")]),s._v(" {\n      "),t("span",{pre:!0,attrs:{class:"hljs-keyword"}},[s._v("const")]),s._v(" attrName = attr.name\n      "),t("span",{pre:!0,attrs:{class:"hljs-keyword"}},[s._v("const")]),s._v(" attrValue = attr.value\n      "),t("span",{pre:!0,attrs:{class:"hljs-keyword"}},[s._v("if")]),s._v(" (attrName.startsWith("),t("span",{pre:!0,attrs:{class:"hljs-string"}},[s._v("'v-'")]),s._v(")) {\n        "),t("span",{pre:!0,attrs:{class:"hljs-comment"}},[s._v("// v-model、v-text、v-html等指令")]),s._v("\n        "),t("span",{pre:!0,attrs:{class:"hljs-comment"}},[s._v('// 例如：v-html="htmlContent"')]),s._v("\n        "),t("span",{pre:!0,attrs:{class:"hljs-comment"}},[s._v("// 解析出：html和htmlContent，html对应更新方法，htmlContent对应data中的值")]),s._v("\n        "),t("span",{pre:!0,attrs:{class:"hljs-keyword"}},[s._v("const")]),s._v(" dir = attrName.substring("),t("span",{pre:!0,attrs:{class:"hljs-number"}},[s._v("2")]),s._v(")\n        "),t("span",{pre:!0,attrs:{class:"hljs-comment"}},[s._v("// 执行")]),s._v("\n        "),t("span",{pre:!0,attrs:{class:"hljs-keyword"}},[s._v("this")]),s._v("[dir] && "),t("span",{pre:!0,attrs:{class:"hljs-keyword"}},[s._v("this")]),s._v("[dir](node, attrValue)\n      } "),t("span",{pre:!0,attrs:{class:"hljs-keyword"}},[s._v("else")]),s._v(" "),t("span",{pre:!0,attrs:{class:"hljs-keyword"}},[s._v("if")]),s._v(" (attrName.startsWith("),t("span",{pre:!0,attrs:{class:"hljs-string"}},[s._v("'@'")]),s._v(")) {\n        "),t("span",{pre:!0,attrs:{class:"hljs-comment"}},[s._v('// @click="clickHandle"')]),s._v("\n        "),t("span",{pre:!0,attrs:{class:"hljs-comment"}},[s._v("// 解析出click，给元素添加对应的事件，回调事件的名称就是clickHandle")]),s._v("\n        "),t("span",{pre:!0,attrs:{class:"hljs-keyword"}},[s._v("const")]),s._v(" event = attrName.substring("),t("span",{pre:!0,attrs:{class:"hljs-number"}},[s._v("1")]),s._v(")\n        "),t("span",{pre:!0,attrs:{class:"hljs-comment"}},[s._v("// 从methods里面取出方法")]),s._v("\n        "),t("span",{pre:!0,attrs:{class:"hljs-keyword"}},[s._v("const")]),s._v(" methods = "),t("span",{pre:!0,attrs:{class:"hljs-keyword"}},[s._v("this")]),s._v(".$vm.$options.methods\n        "),t("span",{pre:!0,attrs:{class:"hljs-keyword"}},[s._v("const")]),s._v(" method = methods && methods[attrValue]\n        "),t("span",{pre:!0,attrs:{class:"hljs-comment"}},[s._v("// 设置事件监听")]),s._v("\n        node.addEventListener(event, method.bind("),t("span",{pre:!0,attrs:{class:"hljs-keyword"}},[s._v("this")]),s._v(".$vm))\n      }\n    })\n  }\n\n  "),t("span",{pre:!0,attrs:{class:"hljs-comment"}},[s._v("// 处理插值文本")]),s._v("\n  text(node) {\n    "),t("span",{pre:!0,attrs:{class:"hljs-comment"}},[s._v("// 调用update，生成textUpdater方法，并执行调用")]),s._v("\n    "),t("span",{pre:!0,attrs:{class:"hljs-keyword"}},[s._v("this")]),s._v(".update(node, "),t("span",{pre:!0,attrs:{class:"hljs-built_in"}},[s._v("RegExp")]),s._v(".$"),t("span",{pre:!0,attrs:{class:"hljs-number"}},[s._v("1")]),s._v(", "),t("span",{pre:!0,attrs:{class:"hljs-string"}},[s._v("'text'")]),s._v(")\n  }\n\n  "),t("span",{pre:!0,attrs:{class:"hljs-comment"}},[s._v("// 处理v-html")]),s._v("\n  html(node, exp) {\n    "),t("span",{pre:!0,attrs:{class:"hljs-comment"}},[s._v("// 调用update，生成htmlUpdater方法，并执行调用")]),s._v("\n    "),t("span",{pre:!0,attrs:{class:"hljs-keyword"}},[s._v("this")]),s._v(".update(node, exp, "),t("span",{pre:!0,attrs:{class:"hljs-string"}},[s._v("'html'")]),s._v(")\n  }\n\n  "),t("span",{pre:!0,attrs:{class:"hljs-comment"}},[s._v("// 处理v-model")]),s._v("\n  model(node, exp) {\n    "),t("span",{pre:!0,attrs:{class:"hljs-comment"}},[s._v("// 调用update，生成modelUpdater方法，并执行调用")]),s._v("\n    "),t("span",{pre:!0,attrs:{class:"hljs-keyword"}},[s._v("this")]),s._v(".update(node, exp, "),t("span",{pre:!0,attrs:{class:"hljs-string"}},[s._v("'model'")]),s._v(")\n    "),t("span",{pre:!0,attrs:{class:"hljs-comment"}},[s._v("// 监听事件")]),s._v("\n    node.addEventListener("),t("span",{pre:!0,attrs:{class:"hljs-string"}},[s._v("'input'")]),s._v(", e => {\n      "),t("span",{pre:!0,attrs:{class:"hljs-keyword"}},[s._v("this")]),s._v(".$vm[exp] = e.target.value\n    })\n  }\n\n  "),t("span",{pre:!0,attrs:{class:"hljs-comment"}},[s._v("// 生成更新函数，并执行，创建对应的watcher")]),s._v("\n  update(node, exp, dir) {\n    "),t("span",{pre:!0,attrs:{class:"hljs-keyword"}},[s._v("const")]),s._v(" fn = "),t("span",{pre:!0,attrs:{class:"hljs-keyword"}},[s._v("this")]),s._v("[dir + "),t("span",{pre:!0,attrs:{class:"hljs-string"}},[s._v("'Updater'")]),s._v("]\n    fn && fn(node, "),t("span",{pre:!0,attrs:{class:"hljs-keyword"}},[s._v("this")]),s._v(".$vm[exp])\n\n    "),t("span",{pre:!0,attrs:{class:"hljs-comment"}},[s._v("// 更新")]),s._v("\n    "),t("span",{pre:!0,attrs:{class:"hljs-keyword"}},[s._v("new")]),s._v(" Watcher("),t("span",{pre:!0,attrs:{class:"hljs-keyword"}},[s._v("this")]),s._v(".$vm, exp, val => {\n      fn && fn(node, val)\n    })\n  }\n\n  "),t("span",{pre:!0,attrs:{class:"hljs-comment"}},[s._v("// 更新函数")]),s._v("\n  "),t("span",{pre:!0,attrs:{class:"hljs-comment"}},[s._v("// 插值")]),s._v("\n  textUpdater(node, val) {\n    node.textContent = val\n  }\n\n  "),t("span",{pre:!0,attrs:{class:"hljs-comment"}},[s._v("// v-html")]),s._v("\n  htmlUpdater(node, val) {\n    node.innerHTML = val\n  }\n\n  "),t("span",{pre:!0,attrs:{class:"hljs-comment"}},[s._v("// v-model")]),s._v("\n  modelUpdater(node, val) {\n    node.value = val\n  }\n\n  "),t("span",{pre:!0,attrs:{class:"hljs-comment"}},[s._v("// 类型判断")]),s._v("\n  isElement(node) {\n    "),t("span",{pre:!0,attrs:{class:"hljs-keyword"}},[s._v("return")]),s._v(" node.nodeType === "),t("span",{pre:!0,attrs:{class:"hljs-number"}},[s._v("1")]),s._v("\n  }\n\n  isInterpolation(node) {\n    "),t("span",{pre:!0,attrs:{class:"hljs-keyword"}},[s._v("return")]),s._v(" node.nodeType === "),t("span",{pre:!0,attrs:{class:"hljs-number"}},[s._v("3")]),s._v(" && "),t("span",{pre:!0,attrs:{class:"hljs-regexp"}},[s._v("/\\{\\{(.*)\\}\\}/")]),s._v(".test(node.textContent)\n  }\n}\n")])]),t("p",[s._v("以上就实现了一个简单的 "),t("code",{pre:!0},[s._v("mvvm")]),s._v(" 框架，这也是 "),t("code",{pre:!0},[s._v("vue1.x")]),s._v(" 的实现原理，在 "),t("code",{pre:!0},[s._v("vue1.x")]),s._v(" 中，没有引入虚拟 "),t("code",{pre:!0},[s._v("DOM")]),s._v("，当然也没有 "),t("code",{pre:!0},[s._v("diff")]),s._v("，"),t("strong",[s._v("这样的实现方式有什么不足吗?")])])])}],p=t("2877"),v={},_=Object(p["a"])(v,n,l,!1,null,null,null),c=_.exports,h={components:{md:c}},o=h,d=Object(p["a"])(o,e,r,!1,null,"7c802b7c",null);a["default"]=d.exports}}]);
//# sourceMappingURL=chunk-2d2225a4.05a158c8.js.map